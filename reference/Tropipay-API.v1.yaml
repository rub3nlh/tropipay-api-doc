openapi: 3.0.0
info:
  title: Tropipay API
  version: '1.0'
  contact:
    name: Tropipay Team
    url: www.tropipay.com
    email: soporte@tropipay.com
  termsOfService: 'https://tropipay.com/terms'
  license:
    name: Tropipay - 2020 - All Right Reserved
  description: ''
servers:
  - description: Develop
    url: 'https://tropipay-dev.herokuapp.com/api'
paths:
  /access/login:
    post:
      summary: Getting API Token
      operationId: post-access-login
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: {}
              examples:
                OK:
                  value:
                    user:
                      id: c01af560-c7f4-11e8-849a-1196b4225et9
                      name: John
                      surname: Doe
                      company: My Home
                      email: my@email.com
                      phone: '5555555555'
                      address: 'Catalunia Plaza, Barcelona'
                      walletId: null
                      t_c_version: /terms/v0.0
                      role: user
                      nationality: null
                      state: 1
                      balance: 923412
                      birthDate: '1986-02-03T23:00:00.000Z'
                      countryDestinationId: 1
                      city: Barcelona
                      postalCode: 8013
                      kycLevel: 3
                      occupationId: 6
                      clientTypeId: 1
                      isPublicOffice: false
                      birthCountryId: 0
                      province: Barcelona
                      groupId: 2
                      lastLogin: '2020-03-26T15:27:11.148Z'
                      pendingIn: -41380
                      pendingOut: 0
                      lang: es
                      shortId: YO6S
                      createdAt: '2018-10-04T16:44:24.380Z'
                      updatedAt: '2020-03-26T15:27:11.151Z'
                      validAirbnb: true
                    token: 'eyJhbGciOiJIUzI1NiIsInR5 {...} VPf-Uw'
                example-2: {}
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties: {}
              examples:
                KO:
                  value:
                    error:
                      message:
                        code: 8
                        msg: 'Wrong username or password!'
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
            examples:
              Getting Token:
                value:
                  email: user@email.com
                  password: userP4SSW00rd
        description: Authentication
      tags:
        - Authentication
      description: "#### Using your Token for Authentication\nWith this endpoint you will receive a \"token\" parameter in the response. \n\nYou must use this parameter in the Header of all request you made for a Bearer authentication. \n\n> Header: { \"Authorization\" : \"Bearer {token}\" } "
  /paymentcards:
    get:
      summary: Get Payment Link List
      tags:
        - Payment Link
      responses: {}
      operationId: get-sd
      description: ''
    parameters: []
    post:
      summary: Creating a Payment Link
      operationId: post-paymentcards
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: {}
              examples:
                Response OK Example:
                  value:
                    id: 94790650-f5a1-11e9-a5b8-8db2d78a55d6
                    reference: 23u4cgvz8k23djl85
                    concept: Gif Card - Experiencia culinaria.
                    description: Taxi + Experiencia
                    amount: 14000
                    currency: EUR
                    singleUse: false
                    reasonId: 1
                    userId: 6b16b480-47df-11e9-8b02-d75764f7c812
                    state: 1
                    updatedAt: '2019-10-23T14:29:54.628Z'
                    createdAt: '2019-10-23T14:29:54.102Z'
                    qrImage: 'data:image/png;base64,iVBORw0KG {...} XoGCsAAAAABJRU5ErkJggg=='
                    shortUrl: 'http://bit.ly/2WbaJKS'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties: {}
              examples:
                Invalid Token Example:
                  value:
                    error:
                      msg: 'Failed to authenticate token!'
                      code: 934
      tags:
        - Payment Link
      description: "Charge to your clients or receive a remitance to your account by charge credits cards. \n\nYou will get a short URL and a QR code with the Payment Link "
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reference:
                  type: string
                  description: reference in your system
                concept:
                  type: string
                  description: ''
                description:
                  type: string
                amount:
                  type: integer
                  description: Cents
                currency:
                  type: string
                  description: 'EUR,USD (ISO)'
                singleUse:
                  type: boolean
                  description: true - payment link is closed after use it
                reasonId:
                  type: integer
                  description: See reasson list section for details
                expirationDays:
                  type: integer
                  description: How many days you allow order cancelation
                lang:
                  type: string
                  description: 'Link Payment Language (es,en,pt)'
                urlSuccess:
                  type: string
                  description: OK response redirect to this URL
                urlFailed:
                  type: string
                  description: KO response redirect to this URL
                urlNotification:
                  type: string
                  description: Callback notification with the response data
              required:
                - reference
                - concept
                - description
                - amount
                - currency
                - singleUse
                - reasonId
            examples:
              Creating a Recurrent Payment Link:
                value:
                  reference: your-own-system-reference
                  concept: test
                  description: test
                  amount: 100000
                  currency: EUR
                  singleUse: false
                  reasonId: 2
                  expirationDays: 1
                  lang: es
                  urlSuccess: 'https://mi-negocio.com/pago-ok'
                  urlFailed: 'https://mi-negocio.com/pago-ko'
                  urlNotification: 'https://mi-negocio.com/notificacion-pago'
        description: ''
      parameters:
        - schema:
            type: string
          in: header
          description: 'Bearer {your-token}'
          name: Authorization
          required: true
  /booking:
    get:
      summary: Getting Transactions List
      tags:
        - Transactions
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
              examples:
                Ex. Response OK:
                  value:
                    count: 2
                    rows:
                      - id: 29950
                        reference: 'DEV:TX1579007965129'
                        bankOrderCode: 'DEV:TX1579007965129'
                        provider: 4
                        userId: c01af560-c7f4-11e8-849a-1196b4225e29
                        bookingDate: null
                        days: null
                        amount: 835
                        currency: EUR
                        originalCurrencyAmount: null
                        destinationAmount: 835
                        destinationCurrency: EUR
                        conversionRate: null
                        providerFee: null
                        ourFee: null
                        realBankFee: null
                        depositaccountId: null
                        payProviderFee: null
                        state: 2
                        serviceId: 3
                        paymentcardId: null
                        expirationDate: null
                        movementTypeId: 3
                        balanceBefore: 715812
                        balanceAfter: 824638
                        createdAt: '2020-01-14T13:19:25.130Z'
                        updatedAt: '2020-01-21T13:13:32.611Z'
                        depositaccount: null
                        service:
                          id: 3
                          name: Recharge
                          slug: RECHARGE
                          service_fee_percent: 0
                          service_fee_fixed: 0
                          tp_fee_percent: 1000
                          tp_fee_fixed: 0
                          type: MARKET_PLACE
                          createdAt: '2019-12-11T11:55:08.025Z'
                          updatedAt: '2019-12-11T11:55:08.025Z'
                        charges: []
                        purchases:
                          - id: 30
                            bookingId: 29950
                            marketproductId: 24
                            target: someuser@nauta.com.cu
                            specification: '1000'
                            providerSpot: 1771
                            fee: -0.121
                            createdAt: '2020-01-14T13:19:25.145Z'
                            updatedAt: '2020-01-14T13:19:25.145Z'
                            marketproduct:
                              slug: nauta01
                      - id: 29936
                        reference: TX1578581766040
                        bankOrderCode: TX1578581766040
                        provider: null
                        userId: c01af560-c7f4-11e8-849a-1196b4225e29
                        bookingDate: null
                        days: null
                        amount: -900
                        currency: EUR
                        originalCurrencyAmount: null
                        destinationAmount: -900
                        destinationCurrency: EUR
                        conversionRate: null
                        providerFee: null
                        ourFee: null
                        realBankFee: null
                        depositaccountId: null
                        payProviderFee: null
                        state: 3
                        serviceId: 3
                        paymentcardId: null
                        expirationDate: null
                        movementTypeId: 1
                        balanceBefore: 738552
                        balanceAfter: 737652
                        createdAt: '2020-01-09T14:56:06.041Z'
                        updatedAt: '2020-01-09T14:56:06.041Z'
                        depositaccount: null
                        service:
                          id: 3
                          name: Recharge
                          slug: RECHARGE
                          service_fee_percent: 0
                          service_fee_fixed: 0
                          tp_fee_percent: 1000
                          tp_fee_fixed: 0
                          type: MARKET_PLACE
                          createdAt: '2019-12-11T11:55:08.025Z'
                          updatedAt: '2019-12-11T11:55:08.025Z'
                        charges: []
                        purchases:
                          - id: 16
                            bookingId: 29936
                            marketproductId: 24
                            target: someuser@nauta.com.cu
                            specification: '1078'
                            providerSpot: 1771
                            fee: 0.130419161676647
                            createdAt: '2020-01-09T14:56:06.065Z'
                            updatedAt: '2020-01-09T14:56:06.065Z'
                            marketproduct:
                              slug: nauta01
                    limit: '10'
                    offset: '0'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties: {}
              examples:
                Ex. KO Unauthorized:
                  value:
                    error:
                      msg: 'Failed to authenticate token!'
      operationId: get-booking
      description: "List All Transactions made by User.\n\nOnly states Charged and Paid.\n\nTransactions in state New and Error are not returned. "
      parameters:
        - schema:
            type: number
          in: query
          name: offset
          description: Pagination Offset - Default 0
        - schema:
            type: number
          in: query
          name: limit
          description: Pagination Limit - Default 10
        - schema:
            type: string
          in: query
          name: criteria
          description: 'Search Criteria (orderCode, Reference, Purchase.target)'
        - schema:
            type: string
          in: header
          name: Authorization
          description: 'Bearer {your-token}'
          required: true
  /booking/charge:
    post:
      summary: ''
      operationId: post-booking-charge
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: {}
              examples:
                Ex. Charge Url created:
                  value:
                    id: 29964
                    reference: referencia001
                    bankOrderCode: k5ijdex8
                    provider: 1
                    userId: c01af560-c7f4-11e8-849a-1196b4225e29
                    bookingDate: '2020-01-16T00:00:00.000Z'
                    days: 0
                    amount: 9012
                    currency: USD
                    originalCurrencyAmount: 10055
                    destinationAmount: 8291
                    destinationCurrency: EUR
                    conversionRate: 1.1157
                    providerFee: 300
                    ourFee: 500
                    payProviderFee: false
                    state: 1
                    serviceId: 1
                    movementTypeId: 2
                    updatedAt: '2020-01-17T19:08:43.353Z'
                    createdAt: '2020-01-17T19:08:43.340Z'
                    depositaccountId: null
                    tmpDestinationAmount: 0
                    realBankFee: null
                    paymentcardId: null
                    expirationDate: null
                    balanceBefore: null
                    balanceAfter: null
                    paymentUrl:
                      chargeUrl: 'https://api.paycomet.com/gateway/ifr-bankstore?MERCHANT_MERCHANTCODE=tanb6cf3&MERCHANT_TERMINAL=8329&OPERATION=1&LANGUAGE=ES&MERCHANT_ORDER=k5ijdex8&MERCHANT_AMOUNT=9012&MERCHANT_CURRENCY=EUR&MERCHANT_MERCHANTSIGNATURE=b1dd1f59f19f1b622132d20941d28545fa5812c969ad257f032a0f2a10d573de&3DSECURE=1&MERCHANT_SCORING=1&MERCHANT_PRODUCTDESCRIPTION=U%3Ac01af560-c7f4-11e8-849a-1196b4225e29%20P%3A1%20R%3Areferencia001&URLOK=http%3A%2F%2Flocalhost%3A3000%2Fcharge_OK&URLKO=http%3A%2F%2Flocalhost%3A3000%2Fcharge_KO'
      tags:
        - Transactions
      description: "Create a charge Url for an OTA Virtual Credit Card.\n\nYou Must send to soporte@tropipay.com a URL for receiving the Callback with the operation response.\n\n> Note:  We are working on Webhooks structures to avoiding this send URL configuration step. "
      parameters:
        - schema:
            type: string
          in: header
          name: Authorization
          description: 'Bearer {your-token}'
          required: true
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
            examples:
              Ex. Creating a Charge URL:
                value:
                  reference: referencia001
                  provider: 1
                  bookingDate: '2020-01-16'
                  originalCurrencyAmount: 10055
                  currency: USD
                  destinationCurrency: EUR
                  lang: es
                  agree: true
                  customUrlOK: 'https://google.com'
                  customUrlKO: 'https://yahoo.es'
  '/marketproducts/{productId}/consume':
    parameters:
      - schema:
          type: string
        name: productId
        in: path
        required: true
        description: Product Id you want to consume (ex. recharge01)
    post:
      summary: Consume a Market Product
      operationId: post-marketproducts-productId-consume
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: {}
              examples:
                Ex. Response OK Consume Cubacel Air Time Recharge:
                  value:
                    status: OK
                    transaction:
                      id: 30039
                      reference: TX1583416644851
                      bankOrderCode: TX1583416644851
                      userId: c01af560-c7f4-11e8-849a-1196b4225e29
                      amount: -1800
                      currency: EUR
                      destinationAmount: -1800
                      destinationCurrency: EUR
                      state: 2
                      movementTypeId: 1
                      serviceId: 3
                      updatedAt: '2020-03-05T13:57:24.852Z'
                      createdAt: '2020-03-05T13:57:24.852Z'
                      transactionId: null
      tags:
        - Market
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
            examples:
              'Ex. Consume a Cubacel Air Time Recharge (productId : recharge01)':
                value:
                  amount: 2000
                  target: '5355555555'
                  operatorId: CU_CU_TopUp
                  notificationUrl: 'https://webhook.site/f6ce41f9-1ea2-4c58-94c4-004967f4erad'
        description: ''
      description: "Consume a product from market. \n\nMarket product Id List: \n\n- recharge01  (AIR TIME)\n\n\nOperator Id List:\n\n{...}\n\n\nThe response from this endpoint is that the order has been taken.\n\nThe result of the operation will be notified with a POST to notificationUrl parameter.\n\n\n> Note: We are working on a WebHook structure to avoid the notification parameter.\n\n"
      parameters:
        - schema:
            type: string
          in: header
          name: Authorization
          description: 'Bearer {your-token}'
          required: true
  /paymentcards/notify:
    post:
      summary: Payment Link Send a Notification
      operationId: post-paymentcards-notify
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: {}
              examples:
                Ex. Response OK:
                  value: OK
      tags:
        - Payment Link
      description: 'Send a notification with the paymeyt link url to someone. '
      parameters:
        - schema:
            type: string
          in: header
          name: Authorization
          description: 'Bearer {your-token}'
          required: true
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
            examples:
              Ex. Notify a client with a payment link url:
                value:
                  cardObj:
                    id: 3a16d4f0-f667-11e9-9445-0f8921378a1d
                  sendEmail: true
                  email: client@email.com
                  sendSMS: true
                  phone: '+53534555555'
                  lang: es
components:
  schemas: {}
